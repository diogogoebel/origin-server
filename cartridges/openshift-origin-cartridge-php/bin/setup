#!/bin/bash -eu

case "$1" in
  -v|--version)
    version="$2"
esac

# Copy the version specific files up to php directory
shopt -s dotglob

if [ "$version" == '5.3' ]; then
  VERSION_DIR=shared
else
  VERSION_DIR="$version"
fi


mkdir -p $OPENSHIFT_PHP_DIR/configuration/etc/
cp -Hr $OPENSHIFT_PHP_DIR/versions/$VERSION_DIR/configuration/etc/* $OPENSHIFT_PHP_DIR/configuration/etc/

# Create/truncate Apache PassEnv configuration file
echo > $OPENSHIFT_PHP_DIR/configuration/etc/conf.d/passenv.conf
echo > $OPENSHIFT_PHP_DIR/configuration/etc/conf.d/performance.conf

cp versions/$VERSION_DIR/configuration/etc/conf.d/performance.conf.erb conf/performance.conf.erb
cp conf/performance.conf.erb conf/performance.conf.erb.hidden
